
***
###### `Title :- Database Enumeration`
###### `Created on :- 2023-06-17 - 19:34`
###### `Created by:- Prem J`
***

- After mastering the commands of MySQL we now need to know how to put SQL injection into use in order to gain information.

#### `MySQL Fingerprinting -->`

- Before enumerating the database, we usually need to identify the type of DBMS we are dealing with. This is because each DBMS has different queries, and knowing what it is will help us know what queries to use.
- If web server is `Apache` or `Nginx`, it is a good guess that the webserver is running on Linux and DBMS is likely **MySQL**.
- If web server is `IIS` the DBMS is likely to be **MSSQL**.
- There are specific payloads that help in fingerprinting the MySQL databases.

|Payload|When to Use|Expected Output|Wrong Output|
|---|---|---|---|
|`SELECT @@version`|When we have full query output|MySQL Version 'i.e. `10.3.22-MariaDB-1ubuntu1`'|In MSSQL it returns MSSQL version. Error with other DBMS.|
|`SELECT POW(1,1)`|When we only have numeric output|`1`|Error with other DBMS|
|`SELECT SLEEP(5)`|Blind/No Output|Delays page response for 5 seconds and returns `0`.|Will not delay response with other DBMS|

- similar to the example in [[Union Injection#`Location of Injection -->`]].

![[Pasted image 20230617194109.jpg]]

- the output means that we are dealing with MariaDB which is similar to MySQL.

#### `INFORMATION_SCHEMA Database -->`

- To pull data from tables using `UNION SELECT`, we need to properly form our `SELECT` queries. To do so, we need the following information:

	- List of databases
	- List of tables within each database
	- List of columns within each table

- with the above information we will be able to form the `SELECT` statements to dump data from DBMS.
- this is where we can utilise `INFORMATION_SCHEMA` Database.
- The [INFORMATION_SCHEMA](https://dev.mysql.com/doc/refman/8.0/en/information-schema-introduction.html) database contains metadata about the databases and tables present on the server. 
- This database plays a crucial role while exploiting SQL injection vulnerabilities. As this is a different database, we cannot call its tables directly with a `SELECT`statement. If we only specify a table's name for a `SELECT` statement, it will look for tables within the same database

- to reference a table inside a database we can use `.` operator

```sql
SELECT * FROM my_database.users; -- users table inside my_datbase
```

#### `SCHEMATA -->`

- The table [SCHEMATA](https://dev.mysql.com/doc/refman/8.0/en/information-schema-schemata-table.html) in the `INFORMATION_SCHEMA` database contains information about all databases on the server. This is the starting step for the enumeration on Databases available on the DBMS.
- It is used to obtain database names so we can then query them. The `SCHEMA_NAME` column contains all the database names currently present.

```shell-session
mysql> SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA;

+--------------------+
| SCHEMA_NAME        |
+--------------------+
| mysql              |
| information_schema |
| performance_schema |
| ilfreight          |
| dev                |
+--------------------+
6 rows in set (0.01 sec)
```

>[!tip]
>The first three databases are the default MySQL databases `mysql`, `information_schema`, `performance_schema`. the other two are databases.

```sql
cn' UNION select 1,schema_name,3,4 from INFORMATION_SCHEMA.SCHEMATA-- -
```

![[Pasted image 20230617211959.png]]

#### `TABLES -->`

- before dumping data from the table we need to know the list of tables to query.
- To find all tables within a database, we can use the `TABLES` table in the `INFORMATION_SCHEMA` Database, it contains info about all the tables throughout the database.
- This table contains multiple columns but we are interested in the `TABLE_SCHEMA` and `TABLE_NAME` columns.
- `TABLE_NAME` column stores table_names
- `TABLE_SCHEMA` column points to the database each table belongs to.
- So we can change the query to 

```sql
cn' UNION select 1,TABLE_NAME,TABLE_SCHEMA,4 from INFORMATION_SCHEMA.TABLES where table_schema='dev'-- -
```

![[Pasted image 20230617230502.jpg]]

- Here we have found all the tables that exist in the database. and what they point to.

#### `COLUMNS -->`

- We have found the tables now we need to dump the data in the tables that we need.
- But we first need to find the column names in the table
- which can be found in the [COLUMNS](https://dev.mysql.com/doc/refman/8.0/en/information-schema-columns-table.html) table in the `INFORMATION_SCHEMA` database. Which contains all the information about the columns present in the database.

```sql
cn' UNION select 1,COLUMN_NAME,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS where table_name='credentials'-- -
```

![[Pasted image 20230617232229.jpg]]

- The target has two columns username and password. Now we can dump data as we have all the required information.

```sql
table_
```

![[Pasted image 20230617232359.png]]

- hence enumeration of databases is solely based on `INFORMATION_SCHEMA.TABLES` and `INFORMATION_SCHEMA.COLUMNS`
